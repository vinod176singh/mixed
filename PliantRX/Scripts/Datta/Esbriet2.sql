
--patient taking ESBRIET
--2570
select count(distinct pat_id) from pharmetrics.claims c where ndc in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET');

--TPS
select extract(year from from_dt),count(distinct pat_id) from pharmetrics.claims c2  where ndc  in(
select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET') group by 1 order by 1;


--NPS
select extract(year from min_dt),count(distinct pat_id) from
(select pat_id ,min(from_dt) as min_dt from pharmetrics.claims c2  where ndc  in(
select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET') group by 1) group by 1 order by 1;

--ESBRIET patient with ILD(including ipf)
--2521
select count(distinct pat_id) from pharmetrics.claims c2 where pat_id in(select distinct pat_id from pharmetrics.claims c where ndc 
in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET'))  and   
(diag_admit in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
 diag1 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag2 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag3 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag4 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag5 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag6 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag7 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag8 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag9 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag10 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag11 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag12 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849'))

--TPS
select extract(year from a.from_dt),count(distinct a.pat_id) from ( select *  from pharmetrics.claims c where ndc in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET'))a
inner join 
(select * from pharmetrics.claims c2  where 
diag_admit in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
 diag1 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag2 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag3 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag4 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag5 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag6 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag7 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag8 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag9 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag10 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag11 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag12 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848',
'J849'))b on a.pat_id=b.pat_id group by 1 order by 1;

--NPS
select extract(year from a.min_dt),count(distinct a.pat_id) from ( select distinct pat_id,min(from_dt) as min_dt  from pharmetrics.claims c where ndc in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET')group by 1)a
inner join 
(select distinct pat_id ,from_dt from pharmetrics.claims c2  where 
diag_admit in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
 diag1 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag2 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag3 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag4 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag5 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag6 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag7 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag8 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag9 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag10 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag11 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag12 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848',
'J849'))b on a.pat_id=b.pat_id group by 1 order by 1;


-----------------------------------------------------------------------------------------------------------------------
---ESBRIET had ipf 
select count(distinct pat_id) from pharmetrics.claims c2 where pat_id in(select distinct pat_id from pharmetrics.claims c where ndc 
in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET')) and ('51631' IN (diag_admit, diag1, diag2, diag3, diag4, diag5, diag6, diag7, diag8, diag9, diag10, diag11, diag12)
        OR 'J84112' IN (diag_admit, diag1, diag2, diag3, diag4, diag5, diag6, diag7, diag8, diag9, diag10, diag11, diag12))
        
        
 --tps
 SELECT year, COUNT(DISTINCT pat_id)
FROM (
    SELECT EXTRACT(YEAR FROM a.from_dt) AS year, a.pat_id
    FROM (
        SELECT DISTINCT pat_id, from_dt
        FROM pharmetrics.claims
        WHERE ndc IN (
            SELECT ndc
            FROM pharmetrics.ndc_codes
            WHERE mkted_prod_nm = 'ESBRIET'
        )
    ) AS a
    inner JOIN (
        SELECT DISTINCT pat_id
        FROM pharmetrics.claims
        WHERE '51631' IN (diag_admit, diag1, diag2, diag3, diag4, diag5, diag6, diag7, diag8, diag9, diag10, diag11, diag12)
            OR 'J84112' IN (diag_admit, diag1, diag2, diag3, diag4, diag5, diag6, diag7, diag8, diag9, diag10, diag11, diag12)
    ) AS b
    ON a.pat_id = b.pat_id
) AS c
GROUP BY year
ORDER BY year;
        


--NPS


        SELECT year, COUNT(DISTINCT pat_id)
FROM (
    SELECT EXTRACT(YEAR FROM a.from_dt) AS year, a.pat_id
    FROM (
        SELECT DISTINCT pat_id, min(from_dt) as from_dt
        FROM pharmetrics.claims
        WHERE ndc IN (
            SELECT ndc
            FROM pharmetrics.ndc_codes
            WHERE mkted_prod_nm = 'ESBRIET'
        ) group by 1
    ) AS a
    inner JOIN (
        SELECT DISTINCT pat_id
        FROM pharmetrics.claims
        WHERE '51631' IN (diag_admit, diag1, diag2, diag3, diag4, diag5, diag6, diag7, diag8, diag9, diag10, diag11, diag12)
            OR 'J84112' IN (diag_admit, diag1, diag2, diag3, diag4, diag5, diag6, diag7, diag8, diag9, diag10, diag11, diag12)
    ) AS b
    ON a.pat_id = b.pat_id
) AS c
GROUP BY year
ORDER BY year;
------------------------------------------------------------------------------------------------------------------------------------
--patient with no ipf and no ILD

select count(distinct pat_id) from (select pat_id from pharmetrics.claims c where ndc in(select distinct ndc from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET'))
 where pat_id  not in(select distinct pat_id from pharmetrics.claims c2 where
(diag_admit in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag1 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag2 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag3 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag4 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag5 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag6 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag7 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag8 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag9 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag10 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag11 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag12 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115',
'J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849')))
        
--Tps
select extract(year from from_dt),count(distinct pat_id) from( select  distinct pat_id ,from_dt from pharmetrics.claims c where ndc in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET'))
where pat_id  not in  (select distinct pat_id from pharmetrics.claims c2  where
(diag_admit  in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
 diag1 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag2 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag3 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag4 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag5 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag6 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag7 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag8 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag9 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag10 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag11 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag12 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115',
 'J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849'))) group by 1 order by 1;


 ---NPS
select extract(year from min_dt),count(distinct pat_id) from(select  distinct pat_id ,min(from_dt) as min_dt    from pharmetrics.claims c where 
ndc in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET')group by 1)
where pat_id  not in  (select distinct pat_id from pharmetrics.claims c2  where
(diag_admit  in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
 diag1 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag2 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag3 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag4 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag5 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag6 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag7 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag8 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag9 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag10 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag11 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') or
diag12 in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115',
 'J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849'))) group by 1 order by 1;
---------------------------------------------------------------------------------------------------
--ESBRIET pts had ILD excluding IPF

select count(distinct pat_id) from pharmetrics.claims c2 where pat_id in(select distinct pat_id from pharmetrics.claims c where ndc 
in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET'))  and   
(diag_admit in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
 diag1 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag2 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag3 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag4 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag5 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag6 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag7 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag8 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag9 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag10 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag11 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag12 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849'))

  
--TPS

select extract(year from a.from_dt),count(distinct a.pat_id) from (  
select *  from pharmetrics.claims c where ndc in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET'))a
inner join 
(select * from pharmetrics.claims c2  where 
diag_admit in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
 diag1 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag2 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag3 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag4 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag5 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag6 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag7 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag8 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag9 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag10 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag11 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag12 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848',
'J849'))b on a.pat_id=b.pat_id group by 1 order by 1;

--NPS
select extract(year from a.min_dt),count(distinct a.pat_id) from (  
select distinct pat_id,min(from_dt) as min_dt  from pharmetrics.claims c where ndc in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='ESBRIET')group by 1)a
inner join 
(select distinct pat_id ,from_dt from pharmetrics.claims c2  where 
diag_admit in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
 diag1 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag2 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag3 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag4 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag5 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag6 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag7 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag8 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag9 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag10 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag11 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag12 in('515','5160','5161','5162','51630','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662','51663','51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848',
'J849'))b on a.pat_id=b.pat_id group by 1 order by 1;