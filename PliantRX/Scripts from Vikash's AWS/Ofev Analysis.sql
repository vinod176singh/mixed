--TPS: overall Ofev users
select extract(year from from_dt), pat_id from pharmetrics.claims c2  where ndc  in(
select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='OFEV') group by 1 order by 1;

----TPS: Overall Ofev users with ILD
select extract(year from from_dt), count(distinct  pat_id) from pharmetrics.claims  where ndc  in(
select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='OFEV')
and pat_id in (select distinct pat_id from pharmetrics.claims where(
(diag_admit 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
 diag1 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag2 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag3 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag4 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag5 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag6 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag7 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag8 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag9 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag10 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag11 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848','J849') OR
diag12 
in('515','5160','5161','5162','51630','51631','51632','51633','51634','51635','51636','51637','5164','5165','51661','51662''51663''51664','51669','5169','J8410','J8489','J8401','J8403','J8402','J84111','J84112','J84113','J84114','J84115','J842','J84116','J84117','J8481','J8482','J84841','J84842','J8483','J84843','J84848',
'J849'))
))
group by 1 order by 1


--NPS
select extract(year from min_dt),count(distinct pat_id) from
(select pat_id ,min(from_dt) as min_dt from pharmetrics.claims c2  where ndc  in(
select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='OFEV') group by 1) group by 1 order by 1;


--overall pt count
select count(distinct pat_id) from pharmetrics.claims c where ndc 
in(select distinct ndc  from pharmetrics.ndc_codes nc where mkted_prod_nm='OFEV')


        
